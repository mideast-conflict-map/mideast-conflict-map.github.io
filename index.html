<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Iran – Interactive Layer Map</title>

  <!-- Leaflet CSS & JS (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root {
      --bg: #111;
      --panel: #1b1b1b;
      --text: #e5e5e5;
    }
    html,body {margin:0; height:100%; background:var(--bg); color:var(--text); font-family:system-ui, sans-serif;}
    #map {height:100%; width:100%;}
    .legend{
      background:var(--panel); padding:.75rem 1rem; border-radius:12px; box-shadow:0 0 10px #0006;
      line-height:1.4; font-size:.9rem;
    }
    .legend img{vertical-align:middle; width:22px; height:22px; margin-right:.45rem; filter:drop-shadow(0 0 2px #0008);}
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    /*******************************************************************
     *  1.  DEFINE YOUR LAYERS                                          *
     *******************************************************************/
    const GROUPS = [
      { name: 'IDF Strikes June 2025',     file: 'by_group/IDF_Strikes_June_2025.geojson',   icon: 'icons/large/strike.png',   color: '#e74c3c' },
      { name: 'IDF Evacuation Areas',      file: 'by_group/IDF_Evacuation_Areas.geojson',    icon: 'icons/evac.svg',     color: '#f1c40f' },
      { name: 'Nuclear Sites',             file: 'by_group/Nuclear_Sites.geojson',           icon: 'icons/large/nuclear.png',  color: '#9b59b6' },
      { name: 'Missile Bases',             file: 'by_group/Missile_Bases.geojson',           icon: 'icons/large/missile.png',  color: '#d35400' },
      { name: 'Airfields',                 file: 'by_group/Airfields.geojson',               icon: 'icons/large/airfield.png', color: '#2980b9' },
      { name: 'Naval Bases',               file: 'by_group/Naval_Bases.geojson',             icon: 'icons/large/naval.png',    color: '#16a085' },
      { name: 'National Infrastructure',   file: 'by_group/National_Infrastructure.geojson', icon: 'icons/large/power.png',    color: '#2ecc71' },
      { name: 'Military & IRGC Bases',     file: 'by_group/Military_&_IRGC_Bases.geojson',   icon: 'icons/large/irgc.png',     color: '#c0392b' },
      { name: 'IAF ASZ',                   file: 'by_group/IAF_ASZ.geojson',                 icon: 'icons/asz.svg',      color: '#3498db' },
      { name: 'IAF ASZ Expanded',          file: 'by_group/IAF_ASZ_Expanded.geojson',        icon: 'icons/asz_ex.svg',   color: '#5555ff' },
      { name: 'Israeli Operations 2024',   file: 'by_group/Israeli_Operations_2024.geojson', icon: 'icons/large/israeli.png',  color: '#27ae60' }
    ];

    /*******************************************************************
     *  2.  INIT MAP                                                   *
     *******************************************************************/
    const map = L.map('map', {
      zoomSnap: 1,
      zoomDelta: 1,
      minZoom: 3,
      wheelPxPerZoomLevel: 40
      }).setView([33.5, 48], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    }).addTo(map);

    const overlayLayers = {};       // will feed L.control.layers

    /*******************************************************************
     *  3.  LOAD & STYLE EACH GEOJSON LAYER                            *
     *******************************************************************/
    GROUPS.forEach(meta => {
      fetch(meta.file)
        .then(resp => resp.json())
        .then(data => {
          // polygons / lines use style; points swap for icon markers
          const layer = L.geoJSON(data, {
            style: {color: meta.color, weight: 2, fillOpacity: 0.25},
            pointToLayer: (f, latlng) => L.marker(latlng, {
              icon: L.icon({iconUrl: meta.icon, iconSize: [18, 18]})
            })
          }).addTo(map);

          overlayLayers[meta.name] = layer;

          // once all layers loaded, rebuild the layer‑switcher & legend
          if (Object.keys(overlayLayers).length === GROUPS.length) buildUI();
        })
        .catch(err => console.error('❌  could not load', meta.file, err));
    });

    function buildUI () {
      /* ------------ layer switcher ------------ */
      L.control.layers(null, overlayLayers, { collapsed:false }).addTo(map);

      /* ------------ legend ------------ */
      const legend = L.control({ position:'topright' });
      legend.onAdd = () => {
        const div = L.DomUtil.create('div', 'legend');
        div.innerHTML = GROUPS.map(g =>
          `<div><img src="${g.icon}" alt="">${g.name}</div>`
        ).join('');
        return div;
      };
      legend.addTo(map);

      /* ------------ fit everything, then shove left ------------ */
      const allLayers = L.featureGroup(Object.values(overlayLayers));
      const bounds    = allLayers.getBounds();

      // show the whole dataset (animated = default true)
      map.fitBounds(bounds, { padding:[20,20] });

      // when that movement is DONE, push the viewport 600 px left
      map.once('moveend', () => {
        map.panBy([-600, 0], { animate:false });
      });
    }

  </script>
</body>
</html>
